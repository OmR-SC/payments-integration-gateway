# ğŸ’³ Payment Gateway Integration Service

![.NET](https://img.shields.io/badge/.NET-8.0-512BD4?style=flat&logo=dotnet)
![Docker](https://img.shields.io/badge/Docker-Enabled-2496ED?style=flat&logo=docker)
![Architecture](https://img.shields.io/badge/Architecture-Clean%20%2F%20DDD-green)
![Tests](https://img.shields.io/badge/Tests-xUnit%20%26%20Moq-success)

Una API RESTful robusta diseÃ±ada para simular una pasarela de pagos empresarial. Este proyecto implementa **Clean Architecture** para procesar transacciones, validarlas y transformarlas mediante **XSLT** para la integraciÃ³n con sistemas bancarios Legacy (Mainframes).

---

## ğŸš€ CaracterÃ­sticas Principales

* **Arquitectura Limpia (DDD):** SeparaciÃ³n estricta de responsabilidades (Domain, Application, Infrastructure, API).
* **IntegraciÃ³n Bancaria Legacy:** TransformaciÃ³n de objetos modernos a XML estÃ¡ndar (ISO) y conversiÃ³n a formatos propietarios bancarios usando **XSLT 1.0**.
* **Seguridad:** Enmascaramiento de datos sensibles (PCI DSS Compliance bÃ¡sico) y gestiÃ³n de secretos con User Secrets.
* **Idempotencia:** PrevenciÃ³n de cobros duplicados basada en `MerchantOrderId`.
* **ContainerizaciÃ³n:** Despliegue automÃ¡tico de API + SQL Server usando **Docker Compose**.
* **Calidad de CÃ³digo:** Pruebas unitarias automatizadas con **xUnit** y **Moq**.

---

## ğŸ› ï¸ TecnologÃ­as

* **Core:** .NET 8 (C#)
* **Database:** SQL Server 2022 / Entity Framework Core (Code-First)
* **Testing:** xUnit, Moq
* **DevOps:** Docker, Docker Compose
* **Integration:** System.Xml, XslCompiledTransform

---

## ğŸ“¸ GalerÃ­a del Proyecto

### 1. Interfaz API (Swagger)
Punto de entrada para probar los endpoints de pago.
![Swagger UI](assets/swagger-ui.png)

### 2. Respuesta de IntegraciÃ³n (JSON + XML)
La API devuelve no solo el estado del pago, sino tambiÃ©n evidencia de auditorÃ­a (XML generado) y seguridad (Tarjeta enmascarada).
![JSON Response](assets/response-json.png)

### 3. TransformaciÃ³n XSLT (Logs)
Evidencia de la conversiÃ³n de formatos en tiempo real para el Core Bancario.
![Console Logs](assets/console-logs.png)

### 4. Pruebas Unitarias
Cobertura de la lÃ³gica de negocio asegurando la estabilidad del sistema.
![Unit Tests](assets/unit-tests.png)

---

## ğŸ—ï¸ Arquitectura del Sistema

El proyecto sigue una estructura de capas concÃ©ntricas:

```text
src/
â”œâ”€â”€ 1. Domain          # Entidades (Payment) y Reglas de Negocio Puras
â”œâ”€â”€ 2. Application     # Casos de Uso (Services), DTOs e Interfaces
â”œâ”€â”€ 3. Infrastructure  # Base de Datos, Repositorios e IntegraciÃ³n (XML/XSLT)
â”œâ”€â”€ 4. API             # Controladores REST y configuraciÃ³n de Docker
â””â”€â”€ 5. Tests           # Pruebas Unitarias Aisladas
```
## ğŸ³ EjecuciÃ³n RÃ¡pida (Docker)
Para levantar todo el entorno (Base de Datos + API) sin instalar dependencias:

## 1. Clonar el repositorio
git clone [https://github.com/OmR-SC/payments-integration-gateway.git](https://github.com/OmR-SC/payments-integration-gateway.git)

## 2. Levantar con Docker Compose
```
docker compose up --build
```

La API estarÃ¡ disponible en: http://localhost:8080/swagger

## ğŸ’» EjecuciÃ³n Local (Desarrollo)
Si prefieres correrlo con Visual Studio o VS Code:

1. Configura tu cadena de conexiÃ³n en User Secrets.

2. Aplica las migraciones:

    ```
    dotnet ef database update --project Infrastructure --startup-project API
    ```

3. Ejecuta la API:

    ```
    dotnet run --project API
    ```
## ğŸ§ª Estrategia de Pruebas

El proyecto utiliza **xUnit** para pruebas unitarias y **Moq** para aislar dependencias.

### Ejemplo de Cobertura (PaymentService)
El test `ProcessPayment_Should_SavePayment_When_OrderIsNew` verifica el flujo completo de un pago exitoso:
1.  **Mocking:** Se simula que la orden no existe en BD (`GetByMerchantOrderIdAsync` devuelve `null`).
2.  **Execution:** Se procesa el pago.
3.  **Verification:**
    * Se valida que `MaskedCardNumber` oculte los primeros 12 dÃ­gitos.
    * Se verifica con `Verify(Times.Once)` que se haya invocado el mÃ©todo de persistencia.

Comando para ejecutar las pruebas:

```
dotnet test
```